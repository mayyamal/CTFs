sudo apt-get install libseccomp-dev

gcc -std=gnu11 secwrap.c -o secwrap -lseccomp




sasd@sasd2017:~/Documents/challenges/challenge7$ ./secwrap bash -c "ls -la"

sasd@sasd2017:~/Documents/challenges/challenge7$ ./secwrap bash -c "echo 'Hello'"



sasd@sasd2017:~/Documents/challenges/challenge7$ strace ./secwrap bash -c "mousepad new &"
execve("./secwrap", ["./secwrap", "bash", "-c", "mousepad new &"], [/* 85 vars */]) = 0
brk(NULL)                               = 0x2150000
access("/etc/ld.so.nohwcap", F_OK)      = -1 ENOENT (No such file or directory)
mmap(NULL, 8192, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS, -1, 0) = 0x7fe249a0e000
access("/etc/ld.so.preload", R_OK)      = -1 ENOENT (No such file or directory)
open("/etc/ld.so.cache", O_RDONLY|O_CLOEXEC) = 3
fstat(3, {st_mode=S_IFREG|0644, st_size=98517, ...}) = 0
mmap(NULL, 98517, PROT_READ, MAP_PRIVATE, 3, 0) = 0x7fe2499f5000
close(3)                                = 0
access("/etc/ld.so.nohwcap", F_OK)      = -1 ENOENT (No such file or directory)
open("/lib/x86_64-linux-gnu/libseccomp.so.2", O_RDONLY|O_CLOEXEC) = 3
read(3, "\177ELF\2\1\1\0\0\0\0\0\0\0\0\0\3\0>\0\1\0\0\0\220\30\2\0\0\0\0\0"..., 832) = 832
fstat(3, {st_mode=S_IFREG|0644, st_size=280848, ...}) = 0
mmap(NULL, 2375912, PROT_READ|PROT_EXEC, MAP_PRIVATE|MAP_DENYWRITE, 3, 0) = 0x7fe2495a6000
mprotect(0x7fe2495d4000, 2097152, PROT_NONE) = 0
mmap(0x7fe2497d4000, 94208, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_FIXED|MAP_DENYWRITE, 3, 0x2e000) = 0x7fe2497d4000
close(3)                                = 0
access("/etc/ld.so.nohwcap", F_OK)      = -1 ENOENT (No such file or directory)
open("/lib/x86_64-linux-gnu/libc.so.6", O_RDONLY|O_CLOEXEC) = 3
read(3, "\177ELF\2\1\1\3\0\0\0\0\0\0\0\0\3\0>\0\1\0\0\0P\t\2\0\0\0\0\0"..., 832) = 832
fstat(3, {st_mode=S_IFREG|0755, st_size=1868984, ...}) = 0
mmap(NULL, 3971488, PROT_READ|PROT_EXEC, MAP_PRIVATE|MAP_DENYWRITE, 3, 0) = 0x7fe2491dc000
mprotect(0x7fe24939c000, 2097152, PROT_NONE) = 0
mmap(0x7fe24959c000, 24576, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_FIXED|MAP_DENYWRITE, 3, 0x1c0000) = 0x7fe24959c000
mmap(0x7fe2495a2000, 14752, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_FIXED|MAP_ANONYMOUS, -1, 0) = 0x7fe2495a2000
close(3)                                = 0
mmap(NULL, 4096, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS, -1, 0) = 0x7fe2499f4000
mmap(NULL, 4096, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS, -1, 0) = 0x7fe2499f3000
mmap(NULL, 4096, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS, -1, 0) = 0x7fe2499f2000
arch_prctl(ARCH_SET_FS, 0x7fe2499f3700) = 0
mprotect(0x7fe24959c000, 16384, PROT_READ) = 0
mprotect(0x7fe2497d4000, 90112, PROT_READ) = 0
mprotect(0x600000, 4096, PROT_READ)     = 0
mprotect(0x7fe249a10000, 4096, PROT_READ) = 0
munmap(0x7fe2499f5000, 98517)           = 0
fstat(1, {st_mode=S_IFCHR|0620, st_rdev=makedev(136, 6), ...}) = 0
brk(NULL)                               = 0x2150000
brk(0x2171000)                          = 0x2171000
write(1, "step 1: init\n", 13step 1: init
)          = 13
prctl(PR_SET_NO_NEW_PRIVS, 1, 0x7fe2495a2780, 0x7fe2492d3290, 0x2150000) = -1 EINVAL (Invalid argument)
prctl(PR_SET_DUMPABLE, 0)               = 0
prctl(PR_SET_NO_NEW_PRIVS, 1, 0, 0, 0)  = 0
seccomp(SECCOMP_SET_MODE_STRICT, 1, NULL) = -1 EINVAL (Invalid argument)
seccomp(SECCOMP_SET_MODE_FILTER, 0, 0x21504a0) = 0
execve(0x7ffe1b2f2e59, [0x7ffe1b2f3018], [/* 0 vars */]) = -1 ENOENT (No such file or directory)
execve(0x7ffe1b2f2e52, [0x7ffe1b2f3018], [/* 0 vars */]) = -1 ENOENT (No such file or directory)
execve(0x7ffe1b2f2e58, [0x7ffe1b2f3018], [/* 0 vars */]) = -1 ENOENT (No such file or directory)
execve(0x7ffe1b2f2e59, [0x7ffe1b2f3018], [/* 0 vars */]) = -1 ENOENT (No such file or directory)
execve(0x7ffe1b2f2e5e, [0x7ffe1b2f3018], [/* 0 vars */]) = -1 ENOENT (No such file or directory)
execve(0x7ffe1b2f2e5f, [0x7ffe1b2f3018], [/* 0 vars */]) = -1 ENOENT (No such file or directory)
execve(0x7ffe1b2f2e62, [0x7ffe1b2f3018], [/* 0 vars */]) = -1 ENOENT (No such file or directory)
execve(0x7ffe1b2f2e63, [0x7ffe1b2f3018], [/* 0 vars */]) = 0
brk(NULL)                               = 0x2014000
access("/etc/ld.so.nohwcap", F_OK)      = -1 ENOENT (No such file or directory)
mmap(NULL, 8192, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS, -1, 0) = 0x7f194c261000
access("/etc/ld.so.preload", R_OK)      = -1 ENOENT (No such file or directory)
open("/etc/ld.so.cache", O_RDONLY|O_CLOEXEC) = 3
fstat(3, {st_mode=S_IFREG|0644, st_size=98517, ...}) = 0
mmap(NULL, 98517, PROT_READ, MAP_PRIVATE, 3, 0) = 0x7f194c248000
close(3)                                = 0
access("/etc/ld.so.nohwcap", F_OK)      = -1 ENOENT (No such file or directory)
open("/lib/x86_64-linux-gnu/libtinfo.so.5", O_RDONLY|O_CLOEXEC) = 3
read(3, "\177ELF\2\1\1\0\0\0\0\0\0\0\0\0\3\0>\0\1\0\0\0p\310\0\0\0\0\0\0"..., 832) = 832
fstat(3, {st_mode=S_IFREG|0644, st_size=167240, ...}) = 0
mmap(NULL, 2264256, PROT_READ|PROT_EXEC, MAP_PRIVATE|MAP_DENYWRITE, 3, 0) = 0x7f194be15000
mprotect(0x7f194be3a000, 2093056, PROT_NONE) = 0
mmap(0x7f194c039000, 20480, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_FIXED|MAP_DENYWRITE, 3, 0x24000) = 0x7f194c039000
close(3)                                = 0
access("/etc/ld.so.nohwcap", F_OK)      = -1 ENOENT (No such file or directory)
open("/lib/x86_64-linux-gnu/libdl.so.2", O_RDONLY|O_CLOEXEC) = 3
read(3, "\177ELF\2\1\1\0\0\0\0\0\0\0\0\0\3\0>\0\1\0\0\0\240\r\0\0\0\0\0\0"..., 832) = 832
fstat(3, {st_mode=S_IFREG|0644, st_size=14608, ...}) = 0
mmap(NULL, 2109680, PROT_READ|PROT_EXEC, MAP_PRIVATE|MAP_DENYWRITE, 3, 0) = 0x7f194bc11000
mprotect(0x7f194bc14000, 2093056, PROT_NONE) = 0
mmap(0x7f194be13000, 8192, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_FIXED|MAP_DENYWRITE, 3, 0x2000) = 0x7f194be13000
close(3)                                = 0
access("/etc/ld.so.nohwcap", F_OK)      = -1 ENOENT (No such file or directory)
open("/lib/x86_64-linux-gnu/libc.so.6", O_RDONLY|O_CLOEXEC) = 3
read(3, "\177ELF\2\1\1\3\0\0\0\0\0\0\0\0\3\0>\0\1\0\0\0P\t\2\0\0\0\0\0"..., 832) = 832
fstat(3, {st_mode=S_IFREG|0755, st_size=1868984, ...}) = 0
mmap(NULL, 4096, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS, -1, 0) = 0x7f194c247000
mmap(NULL, 3971488, PROT_READ|PROT_EXEC, MAP_PRIVATE|MAP_DENYWRITE, 3, 0) = 0x7f194b847000
mprotect(0x7f194ba07000, 2097152, PROT_NONE) = 0
mmap(0x7f194bc07000, 24576, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_FIXED|MAP_DENYWRITE, 3, 0x1c0000) = 0x7f194bc07000
mmap(0x7f194bc0d000, 14752, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_FIXED|MAP_ANONYMOUS, -1, 0) = 0x7f194bc0d000
close(3)                                = 0
mmap(NULL, 4096, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS, -1, 0) = 0x7f194c246000
mmap(NULL, 4096, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS, -1, 0) = 0x7f194c245000
mmap(NULL, 4096, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS, -1, 0) = 0x7f194c244000
arch_prctl(ARCH_SET_FS, 0x7f194c245700) = 0
mprotect(0x7f194bc07000, 16384, PROT_READ) = 0
mprotect(0x7f194be13000, 4096, PROT_READ) = 0
mprotect(0x7f194c039000, 16384, PROT_READ) = 0
mprotect(0x6f3000, 4096, PROT_READ)     = 0
mprotect(0x7f194c263000, 4096, PROT_READ) = 0
munmap(0x7f194c248000, 98517)           = 0
open("/dev/tty", O_RDWR|O_NONBLOCK)     = 3
close(3)                                = 0
brk(NULL)                               = 0x2014000
brk(0x2015000)                          = 0x2015000
open("/usr/lib/locale/locale-archive", O_RDONLY|O_CLOEXEC) = 3
fstat(3, {st_mode=S_IFREG|0644, st_size=10649088, ...}) = 0
mmap(NULL, 10649088, PROT_READ, MAP_PRIVATE, 3, 0) = 0x7f194ae1f000
close(3)                                = 0
brk(0x2016000)                          = 0x2016000
brk(0x2017000)                          = 0x2017000
brk(0x2018000)                          = 0x2018000
getuid()                                = 1000
getgid()                                = 1000
geteuid()                               = 1000
getegid()                               = 1000
rt_sigprocmask(SIG_BLOCK, NULL, [], 8)  = 0
brk(0x2019000)                          = 0x2019000
sysinfo({uptime=9123, loads=[1664, 2464, 192], totalram=2095063040, freeram=1318748160, sharedram=5492736, bufferram=33337344, totalswap=2145382400, freeswap=2145382400, procs=277, totalhigh=0, freehigh=0, mem_unit=1}) = 0
brk(0x201a000)                          = 0x201a000
rt_sigaction(SIGCHLD, {SIG_DFL, [], SA_RESTORER|SA_RESTART, 0x7f194b87c4b0}, {SIG_DFL, [], 0}, 8) = 0
rt_sigaction(SIGCHLD, {SIG_DFL, [], SA_RESTORER|SA_RESTART, 0x7f194b87c4b0}, {SIG_DFL, [], SA_RESTORER|SA_RESTART, 0x7f194b87c4b0}, 8) = 0
rt_sigaction(SIGINT, {SIG_DFL, [], SA_RESTORER, 0x7f194b87c4b0}, {SIG_DFL, [], 0}, 8) = 0
rt_sigaction(SIGINT, {SIG_DFL, [], SA_RESTORER, 0x7f194b87c4b0}, {SIG_DFL, [], SA_RESTORER, 0x7f194b87c4b0}, 8) = 0
rt_sigaction(SIGQUIT, {SIG_DFL, [], SA_RESTORER, 0x7f194b87c4b0}, {SIG_DFL, [], 0}, 8) = 0
rt_sigaction(SIGQUIT, {SIG_DFL, [], SA_RESTORER, 0x7f194b87c4b0}, {SIG_DFL, [], SA_RESTORER, 0x7f194b87c4b0}, 8) = 0
rt_sigprocmask(SIG_BLOCK, NULL, [], 8)  = 0
rt_sigaction(SIGQUIT, {SIG_IGN, [], SA_RESTORER, 0x7f194b87c4b0}, {SIG_DFL, [], SA_RESTORER, 0x7f194b87c4b0}, 8) = 0
uname({sysname="Linux", nodename="sasd2017", ...}) = 0
brk(0x201b000)                          = 0x201b000
brk(0x201c000)                          = 0x201c000
brk(0x201d000)                          = 0x201d000
brk(0x201e000)                          = 0x201e000
brk(0x201f000)                          = 0x201f000
brk(0x2020000)                          = 0x2020000
brk(0x2021000)                          = 0x2021000
stat("/home/sasd/Documents/challenges/challenge7", {st_mode=S_IFDIR|0775, st_size=4096, ...}) = 0
stat(".", {st_mode=S_IFDIR|0775, st_size=4096, ...}) = 0
getpid()                                = 2534
open("/usr/lib/x86_64-linux-gnu/gconv/gconv-modules.cache", O_RDONLY) = 3
fstat(3, {st_mode=S_IFREG|0644, st_size=26258, ...}) = 0
mmap(NULL, 26258, PROT_READ, MAP_SHARED, 3, 0) = 0x7f194c25a000
close(3)                                = 0
brk(0x2022000)                          = 0x2022000
getppid()                               = 2532
stat(".", {st_mode=S_IFDIR|0775, st_size=4096, ...}) = 0
stat("/home/sasd/bin/bash", 0x7fff9842e7b0) = -1 ENOENT (No such file or directory)
stat("/home/sasd/.local/bin/bash", 0x7fff9842e7b0) = -1 ENOENT (No such file or directory)
stat("/usr/local/sbin/bash", 0x7fff9842e7b0) = -1 ENOENT (No such file or directory)
stat("/usr/local/bin/bash", 0x7fff9842e7b0) = -1 ENOENT (No such file or directory)
stat("/usr/sbin/bash", 0x7fff9842e7b0)  = -1 ENOENT (No such file or directory)
stat("/usr/bin/bash", 0x7fff9842e7b0)   = -1 ENOENT (No such file or directory)
stat("/sbin/bash", 0x7fff9842e7b0)      = -1 ENOENT (No such file or directory)
stat("/bin/bash", {st_mode=S_IFREG|0755, st_size=1037528, ...}) = 0
stat("/bin/bash", {st_mode=S_IFREG|0755, st_size=1037528, ...}) = 0
geteuid()                               = 1000
getegid()                               = 1000
getuid()                                = 1000
getgid()                                = 1000
access("/bin/bash", X_OK)               = 0
stat("/bin/bash", {st_mode=S_IFREG|0755, st_size=1037528, ...}) = 0
geteuid()                               = 1000
getegid()                               = 1000
getuid()                                = 1000
getgid()                                = 1000
access("/bin/bash", R_OK)               = 0
stat("/bin/bash", {st_mode=S_IFREG|0755, st_size=1037528, ...}) = 0
stat("/bin/bash", {st_mode=S_IFREG|0755, st_size=1037528, ...}) = 0
geteuid()                               = 1000
getegid()                               = 1000
getuid()                                = 1000
getgid()                                = 1000
access("/bin/bash", X_OK)               = 0
stat("/bin/bash", {st_mode=S_IFREG|0755, st_size=1037528, ...}) = 0
geteuid()                               = 1000
getegid()                               = 1000
getuid()                                = 1000
getgid()                                = 1000
access("/bin/bash", R_OK)               = 0
brk(0x2023000)                          = 0x2023000
brk(0x2024000)                          = 0x2024000
getpgrp()                               = 2532
rt_sigaction(SIGCHLD, {0x447ad0, [], SA_RESTORER|SA_RESTART, 0x7f194b87c4b0}, {SIG_DFL, [], SA_RESTORER|SA_RESTART, 0x7f194b87c4b0}, 8) = 0
getrlimit(RLIMIT_NPROC, {rlim_cur=7817, rlim_max=7817}) = 0
brk(0x2025000)                          = 0x2025000
brk(0x2026000)                          = 0x2026000
rt_sigprocmask(SIG_BLOCK, NULL, [], 8)  = 0
getpeername(0, 0x7fff9842eb10, 0x7fff9842eb0c) = -1 ENOTSOCK (Socket operation on non-socket)
rt_sigprocmask(SIG_BLOCK, NULL, [], 8)  = 0
rt_sigprocmask(SIG_BLOCK, [INT CHLD], [], 8) = 0
clone( <unfinished ...>
+++ killed by SIGSYS +++
Bad system call (core dumped)
